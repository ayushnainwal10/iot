<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ThingSpeak Data</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    canvas {
      max-width: 800px;
    }
  </style>
</head>
<body>
  <h1>ThingSpeak Data</h1>
  <div id="dataContainer">
    <table border="1">
      <tr>
        <th>Entry</th>
        <th>Time</th>
        <th>Temperature (°C)</th>
        <th>Humidity (%)</th>
        <th>Alcohol Level</th>
      </tr>
    </table>
    <canvas id="temperatureChart" width="800" height="400"></canvas>
    <canvas id="humidityChart" width="800" height="400"></canvas>
    <canvas id="alcoholChart" width="800" height="400"></canvas>
  </div>

  <script>
    // Function to fetch and display ThingSpeak data
    function fetchAndDisplayData() {
      // Replace 'YOUR_READ_API_KEY' with your actual ThingSpeak read API key
      var apiKey = '52YLLSNC4X444TI2';

      // Fetch the last 10 entries from the channel feeds
      fetch('https://api.thingspeak.com/channels/2395883/feeds.json?results=10&api_key=' + apiKey)
        .then(response => response.json())
        .then(data => {
          // Display the data in a simple table
          var table = '<table border="1"><tr><th>Entry</th><th>Time</th><th>Temperature (°C)</th><th>Humidity (%)</th><th>Alcohol Level</th></tr>';

          data.feeds.forEach(feed => {
            table += '<tr>';
            table += '<td>' + feed.entry_id + '</td>';
            table += '<td>' + feed.created_at + '</td>';
            table += '<td>' + feed.field1 + '</td>';
            table += '<td>' + feed.field2 + '</td>';
            table += '<td>' + feed.field3 + '</td>';
            table += '</tr>';
          });

          table += '</table>';

          // Display the table in the 'dataContainer' div
          document.getElementById('dataContainer').innerHTML = table;

          // Display charts
          displayChart('temperatureChart', 'Temperature (°C)', data.feeds.map(feed => parseFloat(feed.field1)));
          displayChart('humidityChart', 'Humidity (%)', data.feeds.map(feed => parseFloat(feed.field2)));
          displayChart('alcoholChart', 'Alcohol Level', data.feeds.map(feed => parseFloat(feed.field3)));
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    }

    // Function to display a line chart
    function displayChart(canvasId, label, dataPoints) {
      var ctx = document.getElementById(canvasId).getContext('2d');
      var myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({ length: dataPoints.length }, (_, i) => i + 1),
          datasets: [{
            label: label,
            data: dataPoints,
            borderColor: getRandomColor(),
            borderWidth: 2,
            fill: false
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              type: 'linear',
              position: 'bottom'
            }
          }
        }
      });
    }

    // Function to generate a random color
    function getRandomColor() {
      var letters = '0123456789ABCDEF';
      var color = '#';
      for (var i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }

    // Initial fetch and display
    fetchAndDisplayData();

    // Refresh the data every 15 seconds
    setInterval(fetchAndDisplayData, 15000);
  </script>
</body>
</html>
